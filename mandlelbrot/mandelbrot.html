<html>
  <head>
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Mandelbrot Set</title>
    <style type="text/css">
      html, body {
        width: 100%;
        height: 100%;
        margin: 0px;
        padding: 0px;
        overflow: hidden;
      }
      #bar {
        position:absolute;
        top:0px;
        height:1em;
        padding-top:1em;
        padding-bottom:1em;
        background-color:rgba(0,0,0,.5);
        color:rgb(255,255,255);
        width:100%;
      }
      .opt {
        display:inline-block;
        width:48%;
        text-align:center;
      }
    </style>
    <script type="text/javascript" src="https://omlet.me/a/js/omlet.js"></script>
    <script type="text/javascript" src="mandelbrot.js"></script>
    <script type="text/javascript">
      window.addEventListener("load", function (event) {
          var canvas = document.getElementById("fractal")
          mandelbrot = new Mandelbrot(canvas, 12);
          mandelbrot.resize_to_parent();
      }, false);
      function randomizeColors() {
          mandelbrot.make_palette();
          mandelbrot.resize_to_parent();
      }
      
      //This code renders the image and sends the canvas
      function save() {
        var dataUrl = document.getElementById("fractal").toDataURL("image/jpeg", .7);
        console.log(dataUrl.length);
        var obj = {
          type: "picture",
          data: {
            imageData: dataUrl.substring(dataUrl.indexOf(',') + 1)
          }
        }
        Omlet.exit(obj);
      }
    </script>
  </head>
  <body>
    <canvas id="fractal"></canvas>
    <div id="bar">
      <div class="opt" onclick="randomizeColors()">
        Colors
      </div>
      <div class="opt" onclick="save()">
        Save
      </div>
    </div>
  </body>
</html>
